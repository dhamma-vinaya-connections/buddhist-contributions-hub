name: ðŸ“¦ Publish Library

# TRIGGER: Run manually or on a schedule (e.g., every Sunday)
on:
  workflow_dispatch:
  schedule:
    - cron: '0 0 * * 0' # Weekly (Sunday at Midnight UTC)

permissions:
  contents: write

jobs:
  build-release:
    runs-on: ubuntu-latest
    steps:
      # 1. CHECKOUT CODE
      - name: Checkout Repository
        uses: actions/checkout@v4

      # 2. ZIP THE CONTRIBUTIONS FOLDER
      - name: Archive Contributions
        run: |
          # Zip only the 'Contributions' folder
          zip -r Dhamma-Library.zip Contributions/
          echo "âœ… Library Zipped (Size: $(du -h Dhamma-Library.zip | cut -f1))"

      # 3. GENERATE TAG NAME (Date-Based)
      - name: Get Current Date
        id: date
        run: echo "date=$(date +'%Y-%m-%d')" >> $GITHUB_OUTPUT

      # 4. CREATE RELEASE & UPLOAD ASSET
      - name: Create Release
        uses: softprops/action-gh-release@v1
        with:
          tag_name: v${{ steps.date.outputs.date }}
          name: ðŸ“š Dhamma Library Release (${{ steps.date.outputs.date }})
          body: |
            This is an automated snapshot of the Dhamma Library.
            
            **Contains:**
            - Processed Books & Essays
            - Interconnected Notes
            - Reference Materials
            
            *Generated by the Gatekeeper Protocol.*
          files: Dhamma-Library.zip
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}